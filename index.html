<link rel="stylesheet" href="styles.css" />
<div class="stackable-tabs-component">
  <div class="stack-tab active">
    <div class="stack-tab-inner">
      <div class="stack-tab-title-row active">
        <div class="stack-tab-num active">01.</div>
        <div>
          <div class="stack-tab-title active">Start with a 1% discount</div>
          <div class="stack-tab-content active">when Onramp is your sole lender (applies on your second loan).</div>
        </div>
      </div>
    </div>
  </div>
  <div class="stack-tab">
    <div class="stack-tab-inner">
      <div class="stack-tab-title-row">
        <div class="stack-tab-num">02.</div>
        <div>
          <div class="stack-tab-title">Earn an additional 1% discount</div>
          <div class="stack-tab-content">when Onramp is your sole lender (applies on your second loan).</div>
        </div>
      </div>
    </div>
  </div>
  <div class="stack-tab">
    <div class="stack-tab-inner">
      <div class="stack-tab-title-row">
        <div class="stack-tab-num">03.</div>
        <div>
          <div class="stack-tab-title">Unlock a final 1% discount</div>
          <div class="stack-tab-content">when Onramp is your sole lender (applies on your second loan).</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GSAP Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get all tabs
    const tabs = document.querySelectorAll(".stack-tab");

    // Animation configuration based on the provided timing function and speed
    const animConfig = {
      duration: 0.3, // 300ms as specified in your requirements
      ease: "cubic-bezier(0.64, 0.04, 0.35, 1)", // Exact timing function from your requirements
    };

    // Add click event listener to each tab
    tabs.forEach((tab) => {
      tab.addEventListener("click", function () {
        // If the clicked tab is already active, do nothing
        if (tab.classList.contains("active")) return;

        // Find the currently active tab
        const activeTab = document.querySelector(".stack-tab.active");

        // Deactivate the current active tab with animation
        if (activeTab) {
          // Get elements that need to have 'active' class removed
          const activeTitleRow = activeTab.querySelector(".stack-tab-title-row.active");
          const activeNum = activeTab.querySelector(".stack-tab-num.active");
          const activeTitle = activeTab.querySelector(".stack-tab-title.active");
          const activeContent = activeTab.querySelector(".stack-tab-content.active");

          // Store the current computed styles before removing classes
          // This prevents the sudden jump by capturing the current state
          const contentRect = activeContent.getBoundingClientRect();
          const contentComputedStyle = window.getComputedStyle(activeContent);
          const titleRowComputedStyle = window.getComputedStyle(activeTitleRow);

          // Create a timeline for smooth animation
          const tlOut = gsap.timeline();

          // First, animate to the current computed values to ensure continuity
          tlOut.set(activeContent, {
            height: contentRect.height,
            paddingLeft: contentComputedStyle.paddingLeft,
            fontSize: contentComputedStyle.fontSize,
            marginTop: contentComputedStyle.marginTop,
            opacity: contentComputedStyle.opacity,
          });

          tlOut.set(activeTitleRow, {
            marginLeft: titleRowComputedStyle.marginLeft,
          });

          // Now animate out the active content
          tlOut.to(activeContent, {
            opacity: 0,
            height: 0,
            paddingLeft: "2.5rem",
            fontSize: "1.12rem",
            marginTop: 0,
            duration: animConfig.duration,
            ease: animConfig.ease,
          });

          // Animate the title row
          tlOut.to(
            activeTitleRow,
            {
              marginLeft: 0,
              duration: animConfig.duration * 0.8,
              ease: animConfig.ease,
            },
            "<"
          );

          // Remove active classes after animation completes
          tlOut.call(() => {
            activeTab.classList.remove("active");
            activeTitleRow.classList.remove("active");
            activeNum.classList.remove("active");
            activeTitle.classList.remove("active");
            activeContent.classList.remove("active");
          });
        }

        // Activate the clicked tab with animation
        const tabTitleRow = tab.querySelector(".stack-tab-title-row");
        const tabNum = tab.querySelector(".stack-tab-num");
        const tabTitle = tab.querySelector(".stack-tab-title");
        const tabContent = tab.querySelector(".stack-tab-content");

        // Create animation timeline for the new active tab
        const tlIn = gsap.timeline();

        // Set initial state before adding active classes
        // This prevents any sudden jumps when classes are added
        tlIn.set(tabContent, {
          opacity: 0,
          height: 0,
          paddingLeft: "2.5rem",
          fontSize: "1.12rem",
          marginTop: 0,
        });

        tlIn.set(tabTitleRow, {
          marginLeft: 0,
        });

        // Add active classes after setting initial state
        tlIn.call(() => {
          tab.classList.add("active");
          tabTitleRow.classList.add("active");
          tabNum.classList.add("active");
          tabTitle.classList.add("active");
          tabContent.classList.add("active");
        });

        // Animate the title row
        tlIn.to(tabTitleRow, {
          marginLeft: "-0.25rem",
          duration: animConfig.duration * 0.8,
          ease: animConfig.ease,
        });

        // Animate in the content
        tlIn.to(
          tabContent,
          {
            opacity: 1,
            height: "auto",
            paddingLeft: 0,
            fontSize: "1.25rem",
            marginTop: "0.75rem",
            duration: animConfig.duration,
            ease: animConfig.ease,
          },
          "<"
        );
      });
    });
  });
</script>
